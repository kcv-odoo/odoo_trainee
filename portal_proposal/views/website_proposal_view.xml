<odoo>
    <template id="proposal_page_template">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">                    
                    <form class="oe_proposal_form js_accept_json" role="form" t-att-data-token="proposals.access_token" t-attf-action="/proposal/#{proposals.id}/access_token=#{proposals.access_token}">
                    <div id="portal_rec" t-attf-class="pb-2 pt-3 #{'card-header bg-white' if report_type == 'html' else ''}">
                        <h2 class="my-0">
                            <h4>Portal Proposal <span t-field="proposals.name"/></h4>
                        </h2>
                    </div>
                    <div class="row" id="details">
                        <div class="mb-3 col-6">
                            <strong>Salesman:</strong> <span t-field="proposals.user_id"/>
                            <br/> 
                            <strong>Customer:</strong> <span t-field="proposals.partner_id"/>
                        </div>
                        <div class="mb-3 col-6">
                            <strong>Pricelist:</strong> <span t-field="proposals.pricelist_id"/>                            
                        </div>
                        <div class="mb-3 col-12">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" id="proposalId" name="proposal_id" t-att-value="proposals.id"/>
                            <input type="hidden" id="proposalToken" name="proposal_token" t-att-value="proposals.access_token"/>
                            <table class="table table-bordered" string="Proposal Lines" id="pr_table">
                                <tr>
                                    <th></th>
                                    <th>Product</th>
                                    <th>Description</th>
                                    <th>Qty Proposed</th>
                                    <th>Qty Accepted</th>
                                    <th>Price Proposed</th>
                                    <th>Price Accepted</th>
                                </tr>
                                <t t-foreach="proposals.line_ids" t-as="line">
                                    <tr>
                                        <td><img t-att-src="image_data_uri(line.product_id.image_1920)" style="max-height: 6rem; max-width: 100%;"/></td>
                                        <td>
                                            <span t-field="line.product_id"/>
                                            <input type="hidden" id="productId" name="product_id" t-att-value="line.product_id.id"/>
                                        </td>                                        
                                        <td><span t-field="line.label"/></td>
                                        <td class="text-right"><span t-field="line.proposed_qty"/></td>
                                        <td class="text-right">
                                            <input t-att-readonly="0" size="5px" id="qty" type="text" class="form-control" name="qty_accepted" t-att-value="line.proposed_qty" required="required"/>
                                        </td>
                                        <td class="text-right"><span t-field="line.proposed_price"/></td>
                                        <td class="text-right">
                                            <input t-att-readonly="0" size="5px" id="price" type="text" class="form-control" name="price_accepted" t-att-value="line.proposed_price" required="true"/>                                            
                                        </td>                                        
                                    </tr>
                                </t>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <b>Total Proposed Amount:</b>
                                        <span t-field="proposals.total_proposed_amt"/>
                                    </td>
                                    <td>
                                        <b>Total Accepted Amount:</b>
                                        <p id="total_acc_amt"><span t-field="proposals.total_proposed_amt"/></p>
                                    </td>                                    
                                </tr> 
                            </table>
                            <t t-esc="proposals.get_portal_url()"/>
                            <br/>
                            <t t-esc="proposals.get_portal_url(suffix='/accept')"/>
                            <button type="button" class="btn btn-primary accept_data" id="acc_btn" t-att-href="proposals.get_portal_url(suffix='/accept')">Accept</button>  
                            <button type="button" class="btn btn-primary reject_data" id="rej_btn">Reject</button>                             
                            <div id="success_div">
                            </div>
                            <div id="proposal_communication" class="mt-4">
                                <h2>History</h2>
                                <t t-call="portal.message_thread">
                                    <t t-set="object" t-value="proposals"/>
                                </t>
                            </div>
                        </div>                                                                    
                    </div>
                    </form>
                </div>
            </div>
        </t>
    </template>

  <!--   <template id="proposal_page_template">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">                    
                    <form class="oe_proposal_form js_accept_json" role="form" t-att-data-token="proposals.access_token" t-attf-action="/proposal/#{proposals.id}/access_token=#{proposals.access_token}">
                </form>
            </div>
        </div>
    </t>
 -->
    <record id="proposal_page" model="website.page">
        <field name="name">Proposal</field>
        <field name="website_published">True</field>
        <field name="url">/proposal/${object.id}?access_token=${object.access_token}</field>
        <field name="view_id" ref="proposal_page_template"/>        
    </record>

    <template id="assets_frontend" name="proposal assets" inherit_id="web.assets_frontend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/portal_proposal/static/src/js/accept_proposal.js"></script>
            <script type="text/javascript" src="/portal_proposal/static/tests/proposal_tests.js"/>
        </xpath>
    </template>

    <template id="qunit_proposal_suite" name="proposal_tests" inherit_id="web.qunit_suite_tests">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/portal_proposal/static/tests/proposal_tests.js"/>
        </xpath>
    </template>

 </odoo>
